<!--pages/statistics/statistics.wxml-->
<view class="container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="header">
    <text class="title">æ—¶é—´ç»Ÿè®¡ä¸­å¿ƒ</text>
    <text class="subtitle">è¿½è¸ªä½ ä¹°å›çš„æ—¶é—´ä»·å€¼</text>
  </view>

  <!-- æ€»ä½“ç»Ÿè®¡å¡ç‰‡ -->
  <view class="overview-section">
    <view class="overview-card">
      <view class="overview-title">æ€»ä½“æˆå°±</view>
      <view class="overview-stats">
        <view class="stat-item">
          <view class="stat-value">{{totalSavedTime.toFixed(1)}}</view>
          <view class="stat-label">å°æ—¶</view>
          <view class="stat-desc">ä¹°å›æ—¶é—´</view>
        </view>
        <view class="stat-item">
          <view class="stat-value">Â¥{{totalSavedMoney.toFixed(0)}}</view>
          <view class="stat-label">å…ƒ</view>
          <view class="stat-desc">èŠ‚çœé‡‘é¢</view>
        </view>
        <view class="stat-item">
          <view class="stat-value">{{totalDecisions}}</view>
          <view class="stat-label">æ¬¡</view>
          <view class="stat-desc">å†³ç­–è®°å½•</view>
        </view>
      </view>
    </view>
  </view>

  <!-- å‘¨æœŸç»Ÿè®¡é€‰æ‹© -->
  <view class="period-section">
    <view class="period-title">ç»Ÿè®¡å‘¨æœŸ</view>
    <picker mode="selector" range="{{['å…¨éƒ¨æ—¶é—´', 'æœ¬æœˆæ•°æ®', 'ä»Šå¹´æ•°æ®']}}" value="{{showPeriod === 'all' ? 0 : (showPeriod === 'monthly' ? 1 : 2)}}" bindchange="onPeriodChange">
      <view class="period-picker">
        {{showPeriod === 'all' ? 'å…¨éƒ¨æ—¶é—´' : (showPeriod === 'monthly' ? 'æœ¬æœˆæ•°æ®' : 'ä»Šå¹´æ•°æ®')}}
      </view>
    </picker>
  </view>

  <!-- å‘¨æœŸç»Ÿè®¡æ•°æ® -->
  <view class="period-stats-section">
    <!-- å…¨éƒ¨æ—¶é—´ç»Ÿè®¡ -->
    <view class="period-card" wx:if="{{showPeriod === 'all'}}">
      <view class="period-card-title">å…¨éƒ¨æ—¶é—´ç»Ÿè®¡</view>
      <view class="period-stats">
        <view class="period-stat">
          <view class="period-stat-label">é›‡äººå†³ç­–</view>
          <view class="period-stat-value">{{hireDecisions}}æ¬¡</view>
        </view>
        <view class="period-stat">
          <view class="period-stat-label">è‡ªå·±åš</view>
          <view class="period-stat-value">{{selfDecisions}}æ¬¡</view>
        </view>
        <view class="period-stat">
          <view class="period-stat-label">åˆ›é€ æ—¶é—´</view>
          <view class="period-stat-value">{{creativeTime.toFixed(1)}}å°æ—¶</view>
        </view>
      </view>
    </view>

    <!-- æœ¬æœˆç»Ÿè®¡ -->
    <view class="period-card" wx:if="{{showPeriod === 'monthly'}}">
      <view class="period-card-title">æœ¬æœˆç»Ÿè®¡</view>
      <view class="period-stats">
        <view class="period-stat">
          <view class="period-stat-label">èŠ‚çœæ—¶é—´</view>
          <view class="period-stat-value">{{monthlyStats.savedTime.toFixed(1)}}å°æ—¶</view>
        </view>
        <view class="period-stat">
          <view class="period-stat-label">èŠ‚çœé‡‘é¢</view>
          <view class="period-stat-value">Â¥{{monthlyStats.savedMoney.toFixed(0)}}</view>
        </view>
        <view class="period-stat">
          <view class="period-stat-label">å†³ç­–æ¬¡æ•°</view>
          <view class="period-stat-value">{{monthlyStats.decisions}}æ¬¡</view>
        </view>
      </view>
    </view>

    <!-- ä»Šå¹´ç»Ÿè®¡ -->
    <view class="period-card" wx:if="{{showPeriod === 'yearly'}}">
      <view class="period-card-title">ä»Šå¹´ç»Ÿè®¡</view>
      <view class="period-stats">
        <view class="period-stat">
          <view class="period-stat-label">èŠ‚çœæ—¶é—´</view>
          <view class="period-stat-value">{{yearlyStats.savedTime.toFixed(1)}}å°æ—¶</view>
        </view>
        <view class="period-stat">
          <view class="period-stat-label">èŠ‚çœé‡‘é¢</view>
          <view class="period-stat-value">Â¥{{yearlyStats.savedMoney.toFixed(0)}}</view>
        </view>
        <view class="period-stat">
          <view class="period-stat-label">å†³ç­–æ¬¡æ•°</view>
          <view class="period-stat-value">{{yearlyStats.decisions}}æ¬¡</view>
        </view>
      </view>
    </view>
  </view>

  <!-- ä»»åŠ¡ç±»å‹ç»Ÿè®¡ -->
  <view class="task-type-section" wx:if="{{Object.keys(taskTypeStats).length > 0}}">
    <view class="section-title">ä»»åŠ¡ç±»å‹åˆ†æ</view>
    <view class="task-type-list">
      <view class="task-type-item" wx:for="{{Object.keys(taskTypeStats)}}" wx:key="*this">
        <view class="task-type-name">{{item}}</view>
        <view class="task-type-stats">
          <view class="task-type-stat">
            <text class="task-type-stat-label">æ¬¡æ•°ï¼š</text>
            <text class="task-type-stat-value">{{taskTypeStats[item].count}}</text>
          </view>
          <view class="task-type-stat">
            <text class="task-type-stat-label">æ—¶é—´ï¼š</text>
            <text class="task-type-stat-value">{{taskTypeStats[item].savedTime.toFixed(1)}}h</text>
          </view>
          <view class="task-type-stat">
            <text class="task-type-stat-label">é‡‘é¢ï¼š</text>
            <text class="task-type-stat-value">Â¥{{taskTypeStats[item].savedMoney.toFixed(0)}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- åˆ›é€ æ—¶é—´è®°å½• -->
  <view class="creative-time-section">
    <view class="section-title">
      åˆ›é€ æ—¶é—´è®°å½•
      <text class="add-creative-time" bindtap="addCreativeTime">+ æ·»åŠ è®°å½•</text>
    </view>
    
    <view class="creative-time-summary">
      <view class="creative-time-total">
        <text class="creative-time-label">æ€»åˆ›é€ æ—¶é—´</text>
        <text class="creative-time-value">{{creativeTime.toFixed(1)}}å°æ—¶</text>
      </view>
    </view>

    <view class="creative-activities" wx:if="{{creativeActivities.length > 0}}">
      <view class="creative-activity-item" wx:for="{{creativeActivities}}" wx:key="timestamp">
        <view class="creative-activity-name">{{item.activity}}</view>
        <view class="creative-activity-time">{{item.hours}}å°æ—¶</view>
        <view class="creative-activity-date">{{item.timestamp.split('T')[0]}}</view>
      </view>
    </view>

    <view class="no-creative-activities" wx:if="{{creativeActivities.length === 0}}">
      <view class="no-creative-icon">ğŸ“</view>
      <view class="no-creative-text">è¿˜æ²¡æœ‰åˆ›é€ æ—¶é—´è®°å½•</view>
      <view class="no-creative-tip">è®°å½•ä½ å¦‚ä½•åˆ©ç”¨èŠ‚çœçš„æ—¶é—´åˆ›é€ ä»·å€¼</view>
    </view>
  </view>

  <!-- æœ€è¿‘å†³ç­–è®°å½• -->
  <view class="recent-decisions-section" wx:if="{{recentDecisions.length > 0}}">
    <view class="section-title">æœ€è¿‘å†³ç­–è®°å½•</view>
    <view class="recent-decisions-list">
      <view class="recent-decision-item" wx:for="{{recentDecisions}}" wx:key="id">
        <view class="recent-decision-header">
          <view class="recent-decision-title">{{item.taskDescription}}</view>
          <view class="recent-decision-result {{item.analysis.decision === 'hire' ? 'hire' : 'self'}}">
            {{item.analysis.decision === 'hire' ? 'é›‡äºº' : 'è‡ªå·±åš'}}
          </view>
        </view>
        <view class="recent-decision-details">
          <text class="recent-decision-time">{{item.estimatedHours}}å°æ—¶</text>
          <text class="recent-decision-price">Â¥{{item.outsourcePrice}}</text>
          <text class="recent-decision-date">{{item.timestamp.split('T')[0]}}</text>
        </view>
      </view>
    </view>
    <view class="view-all-history" bindtap="viewDetailHistory">
      æŸ¥çœ‹å…¨éƒ¨å†å²è®°å½• â†’
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-buttons">
    <button class="btn btn-primary" bindtap="addCreativeTime">è®°å½•åˆ›é€ æ—¶é—´</button>
    <button class="btn btn-secondary" bindtap="viewDetailHistory">æŸ¥çœ‹è¯¦ç»†å†å²</button>
    <button class="btn btn-outline" bindtap="exportData">å¯¼å‡ºæ•°æ®</button>
    <button class="btn btn-danger" bindtap="clearData">æ¸…ç©ºæ•°æ®</button>
  </view>

  <!-- æ¿€åŠ±æ–‡æ¡ˆ -->
  <view class="motivation-section" wx:if="{{totalSavedTime > 0}}">
    <view class="motivation-card">
      <view class="motivation-icon">ğŸ‰</view>
      <view class="motivation-text">
        <text class="motivation-title">å¤ªæ£’äº†ï¼</text>
        <text class="motivation-desc">ä½ å·²ç»ä¹°å›äº† {{totalSavedTime.toFixed(1)}} å°æ—¶çš„æ—¶é—´ï¼Œç»§ç»­ç”¨å®ƒä»¬åˆ›é€ æ›´å¤§ä»·å€¼ï¼</text>
      </view>
    </view>
  </view>
</view>