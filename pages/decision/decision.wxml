<!--pages/decision/decision.wxml-->
<view class="container">
  <!-- 页面标题 -->
  <view class="header card-base">
    <text class="title">雇人决策引擎</text>
    <text class="subtitle">智能判断是否应该雇人代做</text>
  </view>

  <!-- 时间价值显示 -->
  <view class="time-value-section">
    <view class="time-value-card card-base" wx:if="{{timeValue > 0}}">
      <view class="time-value-title">您的时间价值</view>
      <view class="time-value-amount">¥{{timeValue}}/小时</view>
      <view class="time-value-tip">基于您的收入计算得出</view>
    </view>
    
    <view class="no-time-value card-base" wx:if="{{timeValue <= 0}}">
      <view class="no-time-value-icon">⚠️</view>
      <view class="no-time-value-text">尚未设置时间价值</view>
      <button class="btn btn-primary" bindtap="goToCalculator">去计算时间价值</button>
    </view>
  </view>

  <!-- 任务输入区域 -->
  <view class="task-input-section card-base" wx:if="{{timeValue > 0}}">
    <view class="section-title">任务信息</view>
    
    <!-- 任务类型 -->
    <view class="form-group">
      <view class="label">任务类型</view>
      <picker mode="selector" range="{{taskTypes}}" range-key="name" value="{{taskTypeIndex}}" bindchange="onTaskTypeChange">
        <view class="picker">
          {{taskTypes[taskTypeIndex].name}}
        </view>
      </picker>
    </view>

    <!-- 预估时间 -->
    <view class="form-group">
      <view class="label">预估时间 (小时)</view>
      <input 
        class="input" 
        type="digit" 
        placeholder="预估完成需要的时间"
        value="{{estimatedHours}}"
        bindinput="onEstimatedHoursInput"
      />
    </view>

    <!-- 外包价格 -->
    <view class="form-group">
      <view class="label">外包价格 (元)</view>
      <input 
        class="input" 
        type="number" 
        placeholder="外包总费用"
        value="{{outsourcePrice}}"
        bindinput="onOutsourcePriceInput"
      />
    </view>

    <!-- 任务描述 -->
    <view class="form-group">
      <view class="label">任务描述 <text class="optional-tag">(选填)</text></view>
      <textarea 
        class="textarea" 
        placeholder="请详细描述要外包的任务..."
        value="{{taskDescription}}"
        bindinput="onTaskDescriptionInput"
        maxlength="200"
        show-confirm-bar="false"
      ></textarea>
    </view>

    <!-- 分析按钮 -->
    <view class="analyze-section">
      <button class="btn btn-primary btn-large" bindtap="analyzeDecision">
        🤖 开始智能分析
      </button>
    </view>
  </view>

  <!-- 决策结果 -->
  <view class="result-section" wx:if="{{showResult}}">
    <view class="result-card card-base">
      <!-- 决策建议 -->
      <view class="decision-recommendation">
        <view class="recommendation-title">{{analysis.recommendation}}</view>
        <view class="recommendation-subtitle">{{analysis.reason}}</view>
      </view>
      
      <!-- 价格分析 -->
      <view class="price-analysis">
        <view class="price-title">赎回时间单价分析</view>
        <view class="price-detail">
          赎回时间的单价为 ¥{{analysis.pricePerHour}}/小时，为您时间价值的 {{analysis.pricePercentage}}%
        </view>
      </view>
      
      <!-- 对比表格 -->
      <view class="comparison-table">
        <view class="table-header">
          <view class="table-cell">项目</view>
          <view class="table-cell">数值</view>
        </view>
        <view class="table-row">
          <view class="table-cell">您的时间价值</view>
          <view class="table-cell">¥{{analysis.timeValue}}/小时</view>
        </view>
        <view class="table-row">
          <view class="table-cell">赎回时间价格</view>
          <view class="table-cell">¥{{analysis.pricePerHour}}/小时</view>
        </view>
        <view class="table-row">
          <view class="table-cell">差额</view>
          <view class="table-cell {{analysis.savings >= 0 ? 'positive' : 'negative'}}">
            {{analysis.savings >= 0 ? '+' : ''}}¥{{analysis.savings}}/小时
          </view>
        </view>
      </view>
      
      <!-- 总结信息 -->
      <view class="summary-info">
        <view class="summary-text">
          您需要花 ¥{{analysis.price}}，买回自己的 {{analysis.hours}} 小时时间，
          单价为您自己时间价值的 {{analysis.pricePercentage}}%，
          <text class="highlight-text">{{analysis.judgmentText}}</text>
        </view>
      </view>
      
      <!-- 用户选择 -->
      <view class="user-choice-section">
        <view class="choice-title">请做出您的选择：</view>
        <view class="choice-buttons">
          <button class="btn btn-primary choice-btn" bindtap="chooseHire">
            ✅ 买回时间
          </button>
          <button class="btn btn-outline choice-btn" bindtap="chooseSelf">
            ❌ 自己完成
          </button>
        </view>
      </view>
    </view>
  </view>

  <!-- 操作按钮 -->
  <view class="action-buttons" wx:if="{{timeValue > 0}}">
    <button class="btn btn-secondary" bindtap="resetAnalysis" wx:if="{{showResult}}">
      重新分析
    </button>
    <button class="btn btn-outline" bindtap="clearForm">
      清空表单
    </button>
    <button class="btn btn-info" bindtap="viewHistory">
      查看历史
    </button>
  </view>

  <!-- 决策指南 -->
  <view class="decision-guide-section" wx:if="{{timeValue > 0}}">
    <view class="guide-card card-base">
      <view class="guide-title">💡 时间价值分析指南</view>
      <view class="guide-content">
        <text>我们将根据您的时间价值与赎回时间的成本比较，提供三种决策建议：</text>
        <text>• 当赎回时间的成本低于您时间价值的1/4：直接赎回时间，这是高效的投资</text>
        <text>• 当赎回时间的成本在您时间价值的1/4至1倍之间：可考虑赎回，但需评估您的精力消耗</text>
        <text>• 当赎回时间的成本高于您的时间价值：谨慎决策，请确保赎回后的时间用途价值足够高</text>
      </view>
    </view>
  </view>
</view>