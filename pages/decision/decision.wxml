<!--pages/decision/decision.wxml-->
<view class="container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="header card-base">
    <text class="title">é›‡äººå†³ç­–å¼•æ“</text>
    <text class="subtitle">æ™ºèƒ½åˆ¤æ–­æ˜¯å¦åº”è¯¥é›‡äººä»£åš</text>
  </view>



  <!-- æ—¶é—´ä»·å€¼æ˜¾ç¤º -->
  <view class="time-value-section">
    <view class="time-value-card card-base" wx:if="{{timeValue > 0}}">
      <view class="time-value-title">æ‚¨çš„æ—¶é—´ä»·å€¼</view>
      <view class="time-value-amount">Â¥{{timeValue}}/å°æ—¶</view>
      <view class="time-value-tip">ç²¾åŠ›ç³»æ•°èŒƒå›´ï¼š1.0x - 2.0x</view>
    </view>
    
    <view class="no-time-value card-base" wx:if="{{timeValue <= 0}}">
      <view class="no-time-value-icon">âš ï¸</view>
      <view class="no-time-value-text">å°šæœªè®¾ç½®æ—¶é—´ä»·å€¼</view>
      <button class="btn btn-primary" bindtap="goToCalculator">å»è®¡ç®—æ—¶é—´ä»·å€¼</button>
    </view>
  </view>

  <!-- ä»»åŠ¡è¾“å…¥åŒºåŸŸ -->
  <view class="task-input-section card-base" wx:if="{{timeValue > 0}}">
    <view class="section-title">ä»»åŠ¡ä¿¡æ¯</view>
    
    <!-- ä»»åŠ¡æè¿° -->
    <view class="form-group">
      <view class="label">ä»»åŠ¡æè¿°</view>
      <textarea 
        class="textarea" 
        placeholder="è¯·è¯¦ç»†æè¿°è¦å¤–åŒ…çš„ä»»åŠ¡..."
        value="{{taskDescription}}"
        bindinput="onTaskDescriptionInput"
        maxlength="200"
        show-confirm-bar="false"
      ></textarea>
    </view>

    <!-- ä»»åŠ¡ç±»å‹ -->
    <view class="form-group">
      <view class="label">
        ä»»åŠ¡ç±»å‹
        <text class="label-tip" bindtap="showTaskTypeInfo">æŸ¥çœ‹è¯´æ˜</text>
      </view>
      <picker mode="selector" range="{{taskTypes}}" range-key="name" value="{{taskTypeIndex}}" bindchange="onTaskTypeChange">
        <view class="picker">
          {{taskTypes[taskTypeIndex].name}}
        </view>
      </picker>
    </view>

    <!-- é¢„ä¼°æ—¶é—´ -->
    <view class="form-group">
      <view class="label">é¢„ä¼°æ—¶é—´ (å°æ—¶)</view>
      <input 
        class="input" 
        type="digit" 
        placeholder="é¢„ä¼°å®Œæˆéœ€è¦çš„æ—¶é—´"
        value="{{estimatedHours}}"
        bindinput="onEstimatedHoursInput"
      />
    </view>

    <!-- å¤–åŒ…ä»·æ ¼ -->
    <view class="form-group">
      <view class="label">å¤–åŒ…ä»·æ ¼ (å…ƒ)</view>
      <input 
        class="input" 
        type="number" 
        placeholder="å¤–åŒ…æ€»è´¹ç”¨"
        value="{{outsourcePrice}}"
        bindinput="onOutsourcePriceInput"
      />
    </view>

    <!-- åˆ†ææŒ‰é’® -->
    <view class="analyze-section">
      <button class="btn btn-primary btn-large" bindtap="analyzeDecision">
        ğŸ¤– å¼€å§‹æ™ºèƒ½åˆ†æ
      </button>
    </view>
  </view>

  <!-- å†³ç­–ç»“æœ -->
  <view class="result-section" wx:if="{{showResult}}">
    <view class="result-card card-base {{decision === 'hire' ? 'hire-result' : 'self-result'}}">
      <view class="result-header">
        <view class="result-icon">
          {{decision === 'hire' ? 'ğŸ‘¥' : 'ğŸ™‹â€â™‚ï¸'}}
        </view>
        <view class="result-title">
          {{analysis.recommendation}}
        </view>
      </view>
      
      <view class="result-reason">
        {{analysis.reason}}
      </view>
      
      <!-- è°ƒè¯•ä¿¡æ¯ -->
      <view style="background: #ff0000; color: white; padding: 8rpx; margin: 8rpx 0; font-size: 22rpx;">
        è°ƒè¯•ï¼špricePerHour={{analysis.pricePerHour}}, timeCost={{analysis.timeCost}}, price={{analysis.price}}, savings={{analysis.savings}}
      </view>
      
      <view class="result-details">
        <view class="detail-item">
          <view class="detail-label">å¤–åŒ…å•ä»·</view>
          <view class="detail-value">Â¥{{analysis.pricePerHour !== undefined && analysis.pricePerHour !== null ? analysis.pricePerHour.toFixed(2) : '0.00'}}/å°æ—¶</view>
        </view>
        <view class="detail-item">
          <view class="detail-label">ä½ çš„æ—¶é—´æˆæœ¬</view>
          <view class="detail-value">Â¥{{analysis.timeCost !== undefined && analysis.timeCost !== null ? analysis.timeCost.toFixed(2) : '0.00'}}</view>
        </view>
        <view class="detail-item">
          <view class="detail-label">å¤–åŒ…è´¹ç”¨</view>
          <view class="detail-value">Â¥{{analysis.price !== undefined && analysis.price !== null ? analysis.price.toFixed(2) : '0.00'}}</view>
        </view>
        <view class="detail-item {{analysis.savings > 0 ? 'positive' : 'negative'}}">
          <view class="detail-label">
            {{analysis.savings > 0 ? 'èŠ‚çœé‡‘é¢' : 'é¢å¤–æ”¯å‡º'}}
          </view>
          <view class="detail-value">
            {{analysis.savings > 0 ? '+' : ''}}Â¥{{analysis.savings !== undefined && analysis.savings !== null ? analysis.savings.toFixed(2) : '0.00'}}
          </view>
        </view>
      </view>
      
      <view class="result-tip" wx:if="{{analysis.savings > 0}}">
        ğŸ’° æŠ•èµ„å›æŠ¥ç‡: {{analysis.roi !== undefined && analysis.roi !== null ? analysis.roi.toFixed(1) : '0.0'}}%
      </view>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-buttons" wx:if="{{timeValue > 0}}">
    <button class="btn btn-secondary" bindtap="resetAnalysis" wx:if="{{showResult}}">
      é‡æ–°åˆ†æ
    </button>
    <button class="btn btn-outline" bindtap="clearForm">
      æ¸…ç©ºè¡¨å•
    </button>
    <button class="btn btn-info" bindtap="viewHistory">
      æŸ¥çœ‹å†å²
    </button>
  </view>

  <!-- æ¸©é¦¨æç¤º -->
  <view class="tips-section">
    <view class="tips-card card-base">
      <view class="tips-title">ğŸ’¡ å†³ç­–å»ºè®®</view>
      <view class="tips-content">
        <text>â€¢ é™¤äº†ä»·æ ¼ï¼Œè¿˜è¦è€ƒè™‘ä»»åŠ¡è´¨é‡å’Œæ—¶é—´æˆæœ¬</text>
        <text>â€¢ å¤æ‚ä»»åŠ¡å»ºè®®é€‰æ‹©ç»éªŒä¸°å¯Œçš„æœåŠ¡å•†</text>
        <text>â€¢ èŠ‚çœçš„æ—¶é—´æœ€å¥½ç”¨äºæ›´æœ‰ä»·å€¼çš„å·¥ä½œ</text>
      </view>
    </view>
  </view>
</view>