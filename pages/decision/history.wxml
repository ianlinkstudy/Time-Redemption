<!--pages/decision/history.wxml-->
<view class="container">
  <!-- 页面标题 -->
  <view class="header card-base">
    <view class="header-top">
      <button class="back-btn" bindtap="goBack">← 返回</button>
      <text class="title">决策历史</text>
    </view>
    <text class="subtitle">查看您的所有决策记录</text>
  </view>

  <!-- 历史记录列表 -->
  <view class="history-list" wx:if="{{historyList.length > 0}}">
    <view class="history-item card-base" wx:for="{{historyList}}" wx:key="id" data-index="{{index}}" bindtap="viewHistoryDetail">
      <!-- 总结性描述 -->
      <view class="summary-description">
        <view class="summary-content">
          <text class="summary-text">您在{{item.taskTypeChinese}}任务上，{{item.choseHire ? '选择了赎回自己的时间' : '选择了自己完成'}}。</text>
          <view class="summary-choice {{item.choseHire ? 'hire' : 'self'}}">
            <view class="choice-icon">{{item.choseHire ? '⏰' : '🙋‍♂️'}}</view>
            <view class="choice-text">{{item.choseHire ? '赎回时间' : '自己完成'}}</view>
          </view>
        </view>
      </view>
      
      <view class="history-header">
        <view class="task-info">
          <view class="task-title">{{item.taskDescription}}</view>
        </view>
      </view>
      
      <!-- 价格分析表格 -->
      <view class="price-analysis-table">
        <view class="table-row">
          <text class="table-cell">您的时间价值</text>
          <text class="table-cell">¥{{item.userTimeValue}}/小时</text>
        </view>
        <view class="table-row">
          <text class="table-cell">赎回时间价格</text>
          <text class="table-cell {{item.analysis.colorClass}}">¥{{item.analysis.pricePerHour}}/小时</text>
        </view>
        <view class="table-row">
          <text class="table-cell">差额</text>
          <text class="table-cell {{item.analysis.colorClass}}">¥{{item.analysis.priceDifference}}/小时</text>
        </view>
      </view>
      
      <!-- 智能分析结果 -->
      <view class="analysis-result {{item.analysis.colorClass}}-analysis">
        <text class="analysis-text">您需要花 ¥{{item.outsourcePrice}}, 买回自己的{{item.estimatedHours}}小时时间, 单价为您自己时间价值的{{item.analysis.pricePercentage}}%, {{item.analysis.judgmentText}}</text>
      </view>
      

      
      <view class="history-footer">
        <view class="timestamp">{{formatTime(item.timestamp)}}</view>
        <view class="actions">
          <button class="btn-mini btn-danger" catchtap="deleteHistory" data-index="{{index}}">删除</button>
        </view>
      </view>
    </view>
  </view>

  <!-- 空状态 -->
  <view class="empty-state card-base" wx:if="{{historyList.length === 0}}">
    <view class="empty-icon">📋</view>
    <view class="empty-title">暂无决策记录</view>
    <view class="empty-desc">您还没有进行过任何决策分析</view>
    <button class="btn btn-primary" bindtap="goToDecision">去进行决策</button>
  </view>

  <!-- 提示信息 -->
  <view class="tips-section" wx:if="{{historyList.length > 0}}">
    <view class="tips-card card-base">
      <view class="tips-title">💡 记录说明</view>
      <view class="tips-content">
        <text>• 相同任务的分析会更新现有记录，不会重复显示</text>
        <text>• 每次做出选择后，记录会自动更新</text>
        <text>• 时间戳显示的是最后一次更新的时间</text>
      </view>
    </view>
  </view>

  <!-- 底部操作 -->
  <view class="bottom-actions" wx:if="{{historyList.length > 0}}">
    <button class="btn btn-danger" bindtap="clearAllHistory">清空全部历史</button>
  </view>
</view> 