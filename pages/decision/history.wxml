<!--pages/decision/history.wxml-->
<view class="container">
  <!-- 页面标题 -->
  <view class="header card-base">
    <view class="header-top">
      <button class="back-btn" bindtap="goBack">← 返回</button>
      <text class="title">决策历史</text>
    </view>
    <text class="subtitle">查看您的所有决策记录</text>
  </view>

  <!-- 历史记录列表 -->
  <view class="history-list" wx:if="{{historyList.length > 0}}">
    <view class="history-item card-base" wx:for="{{historyList}}" wx:key="id" data-index="{{index}}" bindtap="viewHistoryDetail">
      <view class="history-header">
        <view class="task-info">
          <view class="task-title">{{item.taskDescription}}</view>
          <view class="task-meta">
            <text class="task-type">{{item.taskType}}</text>
            <text class="task-time">{{item.estimatedHours}}小时</text>
            <text class="task-price">¥{{item.outsourcePrice}}</text>
          </view>
        </view>
        <view class="decision-result {{item.analysis.decision === 'hire' ? 'hire' : 'self'}}">
          <view class="result-icon">{{item.analysis.decision === 'hire' ? '👥' : '🙋‍♂️'}}</view>
          <view class="result-text">{{item.analysis.recommendation}}</view>
        </view>
      </view>
      
      <view class="history-details">
        <view class="detail-row">
          <text class="detail-label">外包单价:</text>
          <text class="detail-value">¥{{item.analysis.pricePerHour}}/小时</text>
        </view>
        <view class="detail-row">
          <text class="detail-label">时间价值:</text>
          <text class="detail-value">¥{{item.userTimeValue}}/小时</text>
        </view>
        <view class="detail-row {{item.analysis.savings > 0 ? 'positive' : 'negative'}}">
          <text class="detail-label">{{item.analysis.savings > 0 ? '节省' : '额外支出'}}:</text>
          <text class="detail-value">{{item.analysis.savings > 0 ? '+' : ''}}¥{{item.analysis.savings}}</text>
        </view>
        <view class="detail-row user-choice">
          <text class="detail-label">您的选择:</text>
          <text class="detail-value {{item.choseHire ? 'hire-choice' : 'self-choice'}}">
            {{item.choseHire ? '✅ 选择雇佣' : '❌ 自己完成'}}
          </text>
        </view>
      </view>
      
      <view class="history-footer">
        <view class="timestamp">{{formatTime(item.timestamp)}}</view>
        <view class="actions">
          <button class="btn-mini btn-danger" catchtap="deleteHistory" data-index="{{index}}">删除</button>
        </view>
      </view>
    </view>
  </view>

  <!-- 空状态 -->
  <view class="empty-state card-base" wx:if="{{historyList.length === 0}}">
    <view class="empty-icon">📋</view>
    <view class="empty-title">暂无决策记录</view>
    <view class="empty-desc">您还没有进行过任何决策分析</view>
    <button class="btn btn-primary" bindtap="goToDecision">去进行决策</button>
  </view>

  <!-- 提示信息 -->
  <view class="tips-section" wx:if="{{historyList.length > 0}}">
    <view class="tips-card card-base">
      <view class="tips-title">💡 记录说明</view>
      <view class="tips-content">
        <text>• 相同任务的分析会更新现有记录，不会重复显示</text>
        <text>• 每次做出选择后，记录会自动更新</text>
        <text>• 时间戳显示的是最后一次更新的时间</text>
      </view>
    </view>
  </view>

  <!-- 底部操作 -->
  <view class="bottom-actions" wx:if="{{historyList.length > 0}}">
    <button class="btn btn-danger" bindtap="clearAllHistory">清空全部历史</button>
  </view>
</view> 