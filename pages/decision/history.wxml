<!--pages/decision/history.wxml-->
<view class="container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="header card-base">
    <view class="header-top">
      <button class="back-btn" bindtap="goBack">â† è¿”å›</button>
      <text class="title">å†³ç­–å†å²</text>
    </view>
    <text class="subtitle">æŸ¥çœ‹æ‚¨çš„æ‰€æœ‰å†³ç­–è®°å½•</text>
  </view>

  <!-- å†å²è®°å½•åˆ—è¡¨ -->
  <view class="history-list" wx:if="{{historyList.length > 0}}">
    <view class="history-item card-base" wx:for="{{historyList}}" wx:key="id" data-index="{{index}}" bindtap="viewHistoryDetail">
      <!-- æ€»ç»“æ€§æè¿° -->
      <view class="summary-description">
        <view class="summary-content">
          <text class="summary-text">æ‚¨åœ¨{{item.taskTypeChinese}}ä»»åŠ¡ä¸Šï¼Œ{{item.choseHire ? 'é€‰æ‹©äº†èµå›è‡ªå·±çš„æ—¶é—´' : 'é€‰æ‹©äº†è‡ªå·±å®Œæˆ'}}ã€‚</text>
          <view class="summary-choice {{item.choseHire ? 'hire' : 'self'}}">
            <view class="choice-icon">{{item.choseHire ? 'â°' : 'ğŸ™‹â€â™‚ï¸'}}</view>
            <view class="choice-text">{{item.choseHire ? 'èµå›æ—¶é—´' : 'è‡ªå·±å®Œæˆ'}}</view>
          </view>
        </view>
      </view>
      
      <view class="history-header">
        <view class="task-info">
          <view class="task-title">{{item.taskDescription}}</view>
        </view>
      </view>
      
      <!-- ä»·æ ¼åˆ†æè¡¨æ ¼ -->
      <view class="price-analysis-table">
        <view class="table-row">
          <text class="table-cell">æ‚¨çš„æ—¶é—´ä»·å€¼</text>
          <text class="table-cell">Â¥{{item.userTimeValue}}/å°æ—¶</text>
        </view>
        <view class="table-row">
          <text class="table-cell">èµå›æ—¶é—´ä»·æ ¼</text>
          <text class="table-cell {{item.analysis.colorClass}}">Â¥{{item.analysis.pricePerHour}}/å°æ—¶</text>
        </view>
        <view class="table-row">
          <text class="table-cell">å·®é¢</text>
          <text class="table-cell {{item.analysis.colorClass}}">Â¥{{item.analysis.priceDifference}}/å°æ—¶</text>
        </view>
      </view>
      
      <!-- æ™ºèƒ½åˆ†æç»“æœ -->
      <view class="analysis-result {{item.analysis.colorClass}}-analysis">
        <text class="analysis-text">æ‚¨éœ€è¦èŠ± Â¥{{item.outsourcePrice}}, ä¹°å›è‡ªå·±çš„{{item.estimatedHours}}å°æ—¶æ—¶é—´, å•ä»·ä¸ºæ‚¨è‡ªå·±æ—¶é—´ä»·å€¼çš„{{item.analysis.pricePercentage}}%, {{item.analysis.judgmentText}}</text>
      </view>
      

      
      <view class="history-footer">
        <view class="timestamp">{{formatTime(item.timestamp)}}</view>
        <view class="actions">
          <button class="btn-mini btn-danger" catchtap="deleteHistory" data-index="{{index}}">åˆ é™¤</button>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state card-base" wx:if="{{historyList.length === 0}}">
    <view class="empty-icon">ğŸ“‹</view>
    <view class="empty-title">æš‚æ— å†³ç­–è®°å½•</view>
    <view class="empty-desc">æ‚¨è¿˜æ²¡æœ‰è¿›è¡Œè¿‡ä»»ä½•å†³ç­–åˆ†æ</view>
    <button class="btn btn-primary" bindtap="goToDecision">å»è¿›è¡Œå†³ç­–</button>
  </view>

  <!-- æç¤ºä¿¡æ¯ -->
  <view class="tips-section" wx:if="{{historyList.length > 0}}">
    <view class="tips-card card-base">
      <view class="tips-title">ğŸ’¡ è®°å½•è¯´æ˜</view>
      <view class="tips-content">
        <text>â€¢ ç›¸åŒä»»åŠ¡çš„åˆ†æä¼šæ›´æ–°ç°æœ‰è®°å½•ï¼Œä¸ä¼šé‡å¤æ˜¾ç¤º</text>
        <text>â€¢ æ¯æ¬¡åšå‡ºé€‰æ‹©åï¼Œè®°å½•ä¼šè‡ªåŠ¨æ›´æ–°</text>
        <text>â€¢ æ—¶é—´æˆ³æ˜¾ç¤ºçš„æ˜¯æœ€åä¸€æ¬¡æ›´æ–°çš„æ—¶é—´</text>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œ -->
  <view class="bottom-actions" wx:if="{{historyList.length > 0}}">
    <button class="btn btn-danger" bindtap="clearAllHistory">æ¸…ç©ºå…¨éƒ¨å†å²</button>
  </view>
</view> 